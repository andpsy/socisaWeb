@model socisaWeb.MesajView

<div style="border:solid 1px lightgray; padding:10px; background-color:#FAFAFA; margin:5px;">
    <div class="btn-toolbar" ng-show="ID_DOSAR != null">
        <div class="btn-group">
            <div class="btn-group">
                <a id="inboxLabel" href="#" class="btn btn-default btn-sm" a-disabled="model.MesajJson.Mesaj != null && model.MesajJson.Mesaj.ID == null">{{inbox}}</a>
                <a href="#" class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown" a-disabled="model.MesajJson.Mesaj != null && model.MesajJson.Mesaj.ID == null"><span class="caret"></span></a>
                <ul class="dropdown-menu">
                    <li><a href="#" ng-click="GetMessages(ID_DOSAR)" a-disabled="model.MesajJson.Mesaj != null && model.MesajJson.Mesaj.ID == null">Inbox</a></li>
                    <li><a href="#" ng-click="GetSentMessages(ID_DOSAR)" a-disabled="model.MesajJson.Mesaj != null && model.MesajJson.Mesaj.ID == null">Sent</a></li>
                </ul>
            </div>
            <a href="#" class="btn btn-default btn-sm" ng-click="NewMessage()" a-disabled="model.MesajJson.Mesaj != null && model.MesajJson.Mesaj.ID == null">Mesaj nou</a>
            <a href="#" class="btn btn-default btn-sm" a-disabled="model.MesajJson.Mesaj.ID == null" ng-click="Reply()">Raspunde</a>
            <a href="#" class="btn btn-default btn-sm" ng-show="false">Redirectioneaza</a>
            <a href="#" class="btn btn-default btn-sm" ng-click="GetMessages(ID_DOSAR)" a-disabled="model.MesajJson.Mesaj != null && model.MesajJson.Mesaj.ID == null">Refresh {{newMessages}}</a>
        </div>
    </div>
    <div class="treeview">
        <table id="messagesTable" class="table table-striped table-hover">
            <thead class="treeview_thead" style="width: calc( 100% - 1em );">
                <tr>
                    <th>Subiect</th>
                    <th>De la</th>
                    <th>Catre</th>
                    <th>Data mesaj</th>
                </tr>
            </thead>
            <tbody class="treeview_tbody">
                @if (Model != null && Model.MesajeJson != null && Model.MesajeJson.Length > 0)
                {
                    @TreeView.GetTreeView(Model.MesajeJson, Model.MesajeJson[0].Mesaj.REPLY_TO, 0, 0)
                }
            </tbody>
        </table>
    </div>
</div>
@if (Model != null && Model.MesajJson != null && Model.MesajJson.Mesaj != null)
{
    <div style="border:solid 1px lightgray; padding:10px; background-color:#FAFAFA; margin:5px;" ng-show="model.MesajJson.Mesaj != null">
        <div ng-show="(result.Status == true || result.Status == false) && showMessage" ng-class="result.Status == false ? 'alert alert-danger' : 'alert alert-success'">
            <button type="button" class="close" ng-click="showMessage = false">&times;</button>
            <strong>{{result.Status ? 'Succes!' : 'Eroare!'}}</strong><br />
            <p ng-repeat="s in result.Message.split(';')">
                {{s}}
            </p>
        </div>
        @Html.Label("", new { data_ng_init = String.Format("model.MesajeJson = {0}", Newtonsoft.Json.JsonConvert.SerializeObject(Model.MesajeJson)) })
        <table class="table table-striped table-hover">
            <tr>
                <td style="width:60px; white-space:nowrap;">
                    @Html.HiddenFor(model => model.MesajJson.Mesaj.ID, new { data_ng_model = "model.MesajJson.Mesaj.ID" })
                    @Html.HiddenFor(model => model.MesajJson.Mesaj.ID_DOSAR, new { data_ng_model = "model.MesajJson.Mesaj.ID_DOSAR" })
                    @Html.Label("Catre: ", new { @class = "control-label" })
                </td>
                <td>
                    <div id="receivers" style="margin-right:5px;" dynamic2="html2" a-disabled="model.MesajJson.Mesaj.ID != null"></div>
                </td>
            </tr>
            <tr>
                <td style="width:60px; white-space:nowrap;">

                </td>
                <td>
                    @Html.DropDownList("Catre", new SelectList(Model.InvolvedParties, "ID", "NUME_COMPLET"), new { @id = "select_involvedParties", @class = "form-control input-sm", data_ng_disabled = "model.MesajJson.Mesaj.ID != null", data_ng_model = "involvedParty", data_ng_change = "AddReceiver()", data_ng_init = String.Format("model.InvolvedParties = {0}", Newtonsoft.Json.JsonConvert.SerializeObject(Model.InvolvedParties)) })
                </td>
            </tr>
            <tr>
                <td style="width:60px; white-space:nowrap;">
                    @Html.Label("Tip mesaj: ", new { @class = "control-label" })
                </td>
                <td>
                    @Html.DropDownList("TipMesaj", new SelectList(Model.TipuriMesaj, "ID", "DENUMIRE"), new { @id = "select_TipuriMesaj", @class = "form-control input-sm", data_ng_disabled = "model.MesajJson.Mesaj.ID != null", data_ng_model = "tipMesaj", data_ng_init = String.Format("model.TipuriMesaj = {0}", Newtonsoft.Json.JsonConvert.SerializeObject(Model.TipuriMesaj)) })
                    @Html.HiddenFor(model => model.MesajJson.Mesaj.ID_TIP_MESAJ, new { data_ng_model = "model.MesajJson.Mesaj.ID_TIP_MESAJ" })
                </td>
            </tr>
            <tr>
                <td style="width:60px; white-space:nowrap;">
                    @Html.Label("Subiect: ", new { @class = "control-label" })
                </td>
                <td>
                    @Html.EditorFor(model => model.MesajJson.Mesaj.SUBIECT, new { htmlAttributes = new { @class = "form-control input-sm", data_ng_model = "model.MesajJson.Mesaj.SUBIECT", data_ng_disabled = "model.MesajJson.Mesaj.ID != null" } })
                </td>
            </tr>
            <tr>
                <td style="width:60px; white-space:nowrap;">
                </td>
                <td>
                    @Html.TextAreaFor(model => model.MesajJson.Mesaj.BODY, new { @class = "form-control input-sm", data_ng_disabled = "model.MesajJson.Mesaj.ID != null", data_ng_model = "model.MesajJson.Mesaj.BODY" })
                </td>
            </tr>
            <tr>
                <td style="width:60px; white-space:nowrap;">

                </td>
                <td>
                    <div class="btn-toolbar" ng-show="model.MesajJson.Mesaj.ID == null">
                        <a href="#" class="btn btn-primary btn-sm" ng-click="SendMessage()">Trimite</a>
                        <a href="#" class="btn btn-default btn-sm" ng-click="CancelMessage()">Renunta</a>
                    </div>
                </td>
            </tr>
        </table>
    </div>
    <script>
        resizeTable();
    </script>
}




