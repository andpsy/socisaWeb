@model socisaWeb.MesajView

<div style="border:solid 1px lightgray; padding:10px; background-color:#FAFAFA; margin:5px;">
    <div class="btn-toolbar">
        <div class="btn-group">
            <a href="#" class="btn btn-default btn-sm" ng-click="NewMessage()">Mesaj nou</a>
            <a href="#" class="btn btn-default btn-sm" ng-click="Refresh()">Refresh</a>
        </div>
    </div>
    <div class="treeview">
        <table class="table table-striped table-hover ">
            <thead>
                <tr>
                    <th></th>
                    <th>Subiect</th>
                    <th>De la</th>
                    <th>Data mesaj</th>
                </tr>
            </thead>
            <tbody>
                @if (Model != null && Model.Mesaje != null && Model.Mesaje.Length > 0)
                {
                    @TreeView.GetTreeView(Model.Mesaje, Model.Mesaje[0].REPLY_TO, 0, 0)
                }
            </tbody>
        </table>
    </div>
</div>
@if (Model != null)
{
    <div style="border:solid 1px lightgray; padding:10px; background-color:#FAFAFA; margin:5px;" ng-show="model.Mesaj != null">
        <div ng-show="(result.Status == true || result.Status == false) && showMessage" ng-class="result.Status == false ? 'alert alert-danger' : 'alert alert-success'">
            <button type="button" class="close" ng-click="showMessage = false">&times;</button>
            <strong>{{result.Status ? 'Succes!' : 'Eroare!'}}</strong><br />
            <p ng-repeat="s in result.Message.split(';')">
                {{s}}
            </p>
        </div>
        <div class="btn-toolbar" ng-show="model.Mesaj.ID != null">
            <div class="btn-group">
                <a href="#" class="btn btn-default btn-sm">Raspunde</a>
                <a href="#" class="btn btn-default btn-sm">Redirectioneaza</a>
            </div>
        </div>
        @Html.Label("", new { data_ng_init = String.Format("model.Mesaje = {0}", Newtonsoft.Json.JsonConvert.SerializeObject(Model.Mesaje)) })
        <div class="form-group">
            @Html.HiddenFor(model => model.Mesaj.ID, new { data_ng_model = "model.Mesaj.ID" })
            @Html.HiddenFor(model => model.Mesaj.ID_DOSAR, new { data_ng_model = "model.Mesaj.ID_DOSAR" })
            @Html.Label("Catre: ", new { @class = "control-label" })<div id="receivers" style="margin:5px;padding:5px;" dynamic2="html2"></div>
            @Html.DropDownList("Catre", new SelectList(Model.InvolvedParties, "ID", "NUME_COMPLET"), new { @id = "select_involvedParties", @class = "form-control input-sm", data_ng_disabled = "model.Mesaj.ID != null", data_ng_model = "involvedParty", data_ng_change = "AddReceiver()", data_ng_init = String.Format("model.InvolvedParties = {0}", Newtonsoft.Json.JsonConvert.SerializeObject(Model.InvolvedParties)) })
        </div>
        <div class="form-group">
            @Html.Label("Tip mesaj: ", new { @class = "control-label" })
            @Html.DropDownList("TipMesaj", new SelectList(Model.TipuriMesaj, "ID", "DENUMIRE"), new { @id = "select_TipuriMesaj", @class = "form-control input-sm", data_ng_disabled = "model.Mesaj.ID != null", data_ng_model = "tipMesaj", data_ng_init = String.Format("model.TipuriMesaj = {0}", Newtonsoft.Json.JsonConvert.SerializeObject(Model.TipuriMesaj)) })
            @Html.HiddenFor(model => model.Mesaj.ID_TIP_MESAJ, new { data_ng_model = "model.Mesaj.ID_TIP_MESAJ" })
        </div>
        <div class="form-group">
            @Html.Label("Subiect: ", new { @class = "control-label" })
            @Html.EditorFor(model => model.Mesaj.SUBIECT, new { htmlAttributes = new {  @class = "form-control input-sm", data_ng_model = "model.Mesaj.SUBIECT", data_ng_disabled = "model.Mesaj.ID != null" } })
        </div>
        <div class="form-group">
            @Html.TextAreaFor(model => model.Mesaj.BODY, new { @class = "form-control input-sm", data_ng_disabled = "model.Mesaj.ID != null", data_ng_model = "model.Mesaj.BODY" })
        </div>
        <div class="btn-toolbar" ng-show="model.Mesaj.ID == null">
            <a href="#" class="btn btn-primary btn-sm" ng-click="SendMessage()">Trimite</a>
            <a href="#" class="btn btn-default btn-sm" ng-click="CancelMessage()">Renunta</a>
        </div>
    </div>
}
<script>
    $(document).ready(function () {
        $(".treeview li>ul").css('display', 'none'); // Hide all 2-level ul
        $(".collapsible").click(function (e) {
            e.preventDefault();
            $(this).toggleClass("treeview_collapse expand");
            $(this).closest('li').children('ul').slideToggle();
        });
    });
</script>




