@model socisaWeb.MesajView

<div style="border:solid 1px lightgray; padding:10px; background-color:#FAFAFA; margin:5px;">
    <div class="btn-toolbar" ng-show="ID_DOSAR != null">
        <div class="btn-group">
            <div class="btn-group">
                <a id="inboxLabel" href="#" class="btn btn-default btn-sm" a-disabled="ID_DOSAR == null">{{inbox}}</a>
                <a href="#" class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown" a-disabled="ID_DOSAR == null"><span class="caret"></span></a>
                <ul class="dropdown-menu">
                    <li><a href="#" ng-click="GetMessages(ID_DOSAR)" a-disabled="ID_DOSAR == null">Inbox</a></li>
                    <li><a href="#" ng-click="GetSentMessages(ID_DOSAR)" a-disabled="ID_DOSAR == null">Sent</a></li>
                </ul>
            </div>
            <a href="#" class="btn btn-default btn-sm" ng-click="NewMessage()" a-disabled="ID_DOSAR == null">Mesaj nou</a>
            <a href="#" class="btn btn-default btn-sm" a-disabled="model.MesajJson.Mesaj.ID == null" ng-click="Reply()">Raspunde</a>
            <a href="#" class="btn btn-default btn-sm" ng-show="false">Redirectioneaza</a>
            <a href="#" class="btn btn-default btn-sm" ng-click="GetMessages(ID_DOSAR)" a-disabled="ID_DOSAR == null">Refresh {{newMessages}}</a>
        </div>
    </div>
    <div class="treeview">
        <table id="messagesTable" class="table table-striped table-hover">
            <thead>
                <tr>
                    <th style="width:300px;">
                        <a href="#" ng-click="sortBy('Mesaj.SUBIECT')">Subiect</a>
                        <span class="sortorder" ng-show="propertyName === 'Mesaj.SUBIECT'" ng-class="{reverse: reverse}"></span>
                    </th>
                    <th style="width:300px;">
                        <a href="#" ng-click="sortBy('Mesaj.ID_SENDER')">De la</a>
                        <span class="sortorder" ng-show="propertyName === 'Mesaj.ID_SENDER'" ng-class="{reverse: reverse}"></span>
                    </th>
                    <!--
                    <th>Catre</th>
                    -->
                    <th style="width:150px;">
                        <a href="#" ng-click="sortBy('Mesaj.DATA')">Data mesaj</a>
                        <span class="sortorder" ng-show="propertyName === 'Mesaj.DATA'" ng-class="{reverse: reverse}"></span>
                    </th>
                </tr>
            </thead>
            <tbody>
                <!--
                @if (Model != null && Model.MesajeJson != null && Model.MesajeJson.Length > 0)
                {
                    @TreeView.GetTreeView(Model.MesajeJson, Model.MesajeJson[0].Mesaj.REPLY_TO, 0, 0)
                }
                -->
                <tr>
                    <td colspan="3">
                        <div style="width:100%; height:300px; overflow-y:auto;">
                            <table  class="table table-striped table-hover">
                                <tr ng-repeat="mesaj in model.MesajeJson | orderBy:propertyName:reverse">
                                    <td style="width:300px;"><a href="#" ng-click="SelectMessage(mesaj)">{{mesaj.Mesaj.SUBIECT}}</a></td>
                                    <td style="width:300px;">{{mesaj.Sender.NUME_COMPLET}} ({{mesaj.Sender.EMAIL}})</td>
                                    <td style="width:150px">{{mesaj.Mesaj.DATA | dateFilter | date:"dd.MM.yyyy HH:mm:ss"}}</td>
                                </tr>
                            </table>
                        </div>
                    </td>
                </tr>

            </tbody>
        </table>
    </div>
</div>

    <div style="border:solid 1px lightgray; padding:10px; background-color:#FAFAFA; margin:5px;" ng-show="editMode > 0">
        <div ng-show="(result.Status == true || result.Status == false) && showMessage" ng-class="result.Status == false ? 'alert alert-danger' : 'alert alert-success'">
            <button type="button" class="close" ng-click="showMessage = false">&times;</button>
            <strong>{{result.Status ? 'Succes!' : 'Eroare!'}}</strong><br />
            <p ng-repeat="s in result.Message.split(';')">
                {{s}}
            </p>
        </div>
        @Html.Label("", new { data_ng_init = String.Format("model.MesajeJson = {0}", Newtonsoft.Json.JsonConvert.SerializeObject(Model.MesajeJson)) })
        <table class="table table-striped table-hover">
            <tr ng-show="false">
                <td style="width:60px; white-space:nowrap;">
                    @Html.HiddenFor(model => model.MesajJson.Mesaj.ID, new { data_ng_model = "model.MesajJson.Mesaj.ID" })
                    @Html.HiddenFor(model => model.MesajJson.Mesaj.ID_DOSAR, new { data_ng_model = "model.MesajJson.Mesaj.ID_DOSAR" })
                    @Html.Label("Catre: ", new { @class = "control-label" })
                </td>
                <td>
                    <div id="receivers" style="margin-right:5px;" dynamic2="html2" a-disabled="model.MesajJson.Mesaj.ID != null"></div>
                </td>
            </tr>
            <tr ng-show="false">
                <td style="width:60px; white-space:nowrap;">

                </td>
                <td>
                    @Html.DropDownList("Catre", new SelectList(Model.InvolvedParties, "ID", "NUME_COMPLET"), new { @id = "select_involvedParties", @class = "form-control input-sm", data_ng_disabled = "model.MesajJson.Mesaj.ID != null", data_ng_model = "involvedParty", data_ng_change = "AddReceiver()", data_ng_init = String.Format("model.InvolvedParties = {0}", Newtonsoft.Json.JsonConvert.SerializeObject(Model.InvolvedParties)) })
                </td>
            </tr>
            <tr ng-show="false">
                <td style="width:60px; white-space:nowrap;">
                    @Html.Label("Tip mesaj: ", new { @class = "control-label" })
                </td>
                <td>
                    @Html.DropDownList("TipMesaj", new SelectList(Model.TipuriMesaj, "ID", "DENUMIRE"), new { @id = "select_TipuriMesaj", @class = "form-control input-sm", data_ng_disabled = "model.MesajJson.Mesaj.ID != null", data_ng_model = "tipMesaj", data_ng_init = String.Format("model.TipuriMesaj = {0}", Newtonsoft.Json.JsonConvert.SerializeObject(Model.TipuriMesaj)) })
                    @Html.HiddenFor(model => model.MesajJson.Mesaj.ID_TIP_MESAJ, new { data_ng_model = "model.MesajJson.Mesaj.ID_TIP_MESAJ" })
                </td>
            </tr>
            <tr>
                <td style="width:60px; white-space:nowrap;">
                    @Html.Label("Subiect: ", new { @class = "control-label" })
                </td>
                <td>
                    @Html.EditorFor(model => model.MesajJson.Mesaj.SUBIECT, new { htmlAttributes = new { @class = "form-control input-sm", data_ng_model = "model.MesajJson.Mesaj.SUBIECT", data_ng_disabled = "model.MesajJson.Mesaj.ID != null" } })
                </td>
            </tr>
            <tr>
                <td style="width:60px; white-space:nowrap;">
                </td>
                <td>
                    @Html.TextAreaFor(model => model.MesajJson.Mesaj.BODY, new { @class = "form-control input-sm", data_ng_disabled = "model.MesajJson.Mesaj.ID != null", data_ng_model = "model.MesajJson.Mesaj.BODY" })
                </td>
            </tr>
            <tr ng-if="model.MesajJson.Mesaj.ID == null">
                <td style="width:60px; white-space:nowrap;">

                </td>
                <td>
                    <div class="btn-toolbar">
                        <a href="#" class="btn btn-primary btn-sm" ng-click="SendMessage()">Trimite</a>
                        <a href="#" class="btn btn-default btn-sm" ng-click="CancelMessage()">Renunta</a>
                    </div>
                </td>
            </tr>
        </table>
    </div>





